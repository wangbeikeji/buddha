<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<!-- css -->
<link href="../css/bootstrap.min.css" rel="stylesheet">
<link href="../css/custom.css" rel="stylesheet">

<!-- js -->
<script src="../js/jquery-2.1.1.min.js"></script>
<script src="../js/bootstrap.min.js"></script>

<script type="text/javascript">
$(function() {
	// 预览
	$("#knowledgeListTable").on("click", "a.preview", function(event){
		var id = event.target.id;
		var newTab=window.open('about:blank');
		
		$.ajax({ 
			url: "/buddha/knowledge/" + id, 
			type: "GET",
			headers: {
				Authorization: "eyJhbGciOiJIUzUxMiJ9.eyJhdXRob3JpdGllcyI6IiIsInVzZXJJZCI6Mywic3ViIjoiMTM5Mjg5NTIyNTQiLCJleHAiOjQ0NzAwMDA2OTY1fQ._r485hISBsKmopDQ8JysYg3O9j85ae_ulpLDt1BnKqUq3XvpNjUWsS_YoL9KTH9Vnhy2_EPJeCj83ADBKyV4bg"
			},
			dataType: "json",
			success: function(response) {
				if(response.code === "200") {
					newTab.document.write(response.result.context);
					newTab.focus();
				}
			}
		});
	});
	
	// 删除
	$("#knowledgeListTable").on("click", "a.delete", function(event){
		var id = event.target.id;
		var confirmResult = window.confirm('删除后的数据不能恢复，确定删除吗？');
		if(confirmResult) {
			$.ajax({ 
				url: "/buddha/knowledge/" + id, 
				type: "DELETE",
				headers: {
					Authorization: "eyJhbGciOiJIUzUxMiJ9.eyJhdXRob3JpdGllcyI6IiIsInVzZXJJZCI6Mywic3ViIjoiMTM5Mjg5NTIyNTQiLCJleHAiOjQ0NzAwMDA2OTY1fQ._r485hISBsKmopDQ8JysYg3O9j85ae_ulpLDt1BnKqUq3XvpNjUWsS_YoL9KTH9Vnhy2_EPJeCj83ADBKyV4bg"
				},
				dataType: "json",
				success: function(response) {
					if(response.code === "200") {
						window.location.reload(true);
					}
				}
			});
		}
	});
	
	// 加载佛学知识列表
	$.ajax({ 
		url: "/buddha/knowledge/list", 
		type: "GET",
		headers: {
			Authorization: "eyJhbGciOiJIUzUxMiJ9.eyJhdXRob3JpdGllcyI6IiIsInVzZXJJZCI6Mywic3ViIjoiMTM5Mjg5NTIyNTQiLCJleHAiOjQ0NzAwMDA2OTY1fQ._r485hISBsKmopDQ8JysYg3O9j85ae_ulpLDt1BnKqUq3XvpNjUWsS_YoL9KTH9Vnhy2_EPJeCj83ADBKyV4bg"
		},
		dataType: "json",
		success: function(response) {
			if(response.code === "200") {
				var knowledgeTbody = $("#knowledgeListTable tbody");
				for(var i = 0; i < response.result.length; i++) {
					var data = response.result[i];
					var trHtml = "<tr>";
					trHtml += "<td>" + data.id + "</td>";
					trHtml += "<td>" + data.title + "</td>";
					trHtml += "<td>" + data.type + "</td>";
					trHtml += "<td>" + (data.sortNum?data.sortNum:"") + "</td>";
					trHtml += "<td>";
					trHtml += '<a class="operate preview" id="' + data.id + '">预览</a>';
					trHtml += '　';
					trHtml += '<a class="operate edit" href="edit.html?id=' + data.id + '" target="_self">修改</a>';
					trHtml += '　';
					trHtml += '<a class="operate delete" id="' + data.id + '">删除</a>';
					trHtml += '</td>';
					trHtml += "</tr>";
					
					knowledgeTbody.append(trHtml);
				}
			}
		}
	});
	
});
</script>

</head>
<body>
	<div class="row">
		<div class="col-md-2"></div>
		<div class="col-md-8">
			<div class="bs-callout bs-callout-info" id="callout-type-dl-truncate">
				<h4>佛学知识管理页面</h4>
				<p>管理功能包括列表显示、新增、修改、删除、预览。</p>
			</div>
	
			<div class="button-list">
				<a class="btn btn-default" href="add.html" role="button">　新　增　</a>&nbsp;&nbsp;
				<a class="btn btn-default" href="../index.html" role="button"> 返 回 </a>
			</div>
			
			<table class="table table-bordered" id="knowledgeListTable">
				<thead>
					<tr>
						<th>序号</th>
						<th>标题</th>
						<th>类型</th>
						<th>排序</th>
						<th>操作</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<div class="col-md-2"></div>
	</div>
</body>
</html>